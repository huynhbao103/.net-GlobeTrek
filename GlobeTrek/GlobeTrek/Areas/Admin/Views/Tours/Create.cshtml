@model GlobeTrek.Models.Tour

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<h2>Tạo mới Tour</h2>

@using (Html.BeginForm("Create", "Tours", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    <div class="form-container">
        <h4>Thông tin Tour</h4>
        <hr />

        <div class="form-group">
            @Html.LabelFor(model => model.title, "Tên Tour")
            @Html.EditorFor(model => model.title, new { htmlAttributes = new { @class = "form-control", required = "required" } })
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.description, "Mô tả")
            @Html.TextAreaFor(model => model.description, new { @class = "form-control", rows = "3", required = "required" })
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.price, "Giá Người Lớn")
            @Html.EditorFor(model => model.price, new { htmlAttributes = new { @class = "form-control", type = "number", step = "0.01", required = "required" } })
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.location, "Địa điểm")
            @Html.EditorFor(model => model.location, new { htmlAttributes = new { @class = "form-control", required = "required" } })
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.duration, "Số ngày")
            <input id="duration" type="number" name="duration" class="form-control" min="1" required />
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.tourTypeId, "Loại Tour")
            @Html.DropDownList("tourTypeId", ViewBag.tourTypes as SelectList, "Chọn loại tour", new { @class = "form-control", required = "required" })
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.destinationId, "Điểm đến")
            @Html.DropDownList("destinationId", ViewBag.destinations as SelectList, "Chọn điểm đến", new { @class = "form-control", required = "required" })
        </div>

        <form action="@Url.Action("Create", "Tours")" method="post" enctype="multipart/form-data">
            <input type="file" name="image" />
            <input type="file" name="video" />
            <button type="submit">Tạo Tour</button>
        </form>


        <h4>Số ghế trống</h4>
        <div>
            <button type="button" class="btn btn-info" onclick="generateAvailability()">Tự động điền</button>
            <button type="button" class="btn btn-success" onclick="addManualAvailability()">Thêm thủ công</button>
        </div>
        <div id="availability-container"></div>

        <div class="form-group">
            <input type="submit" value="Tạo Tour" class="btn btn-primary" />
        </div>
    </div>
}

<style>
    .form-container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-control {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .btn {
        margin-right: 10px;
    }

    .availability-item {
        margin-top: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: #fff;
    }
</style>

<script>
    function generateAvailability() {
        let container = document.getElementById("availability-container");
        container.innerHTML = "";
        let duration = parseInt(document.getElementById("duration").value) || 0;
        if (duration < 1) {
            alert("Vui lòng nhập số ngày hợp lệ!");
            return;
        }

        let today = new Date();
        for (let i = 0; i < duration; i++) {
            addAvailability(today, i);
        }
    }

    function addManualAvailability() {
        let today = new Date();
        addAvailability(today);
    }

    function addAvailability(startDate, index = null) {
        let container = document.getElementById("availability-container");
        let date = new Date(startDate);
        date.setDate(date.getDate() + (index !== null ? index : 0));

        let newItem = document.createElement("div");
        newItem.className = "form-group availability-item";
        newItem.innerHTML = `
            <div class="row">
                <div class="col-md-5">
                    <label>Ngày:</label>
                    <input type="date" name="availabilities[${container.children.length}].date" class="form-control" value="${date.toISOString().split('T')[0]}" min="${new Date().toISOString().split('T')[0]}" required />
                </div>
                <div class="col-md-5">
                    <label>Số ghế trống:</label>
                    <input type="number" name="availabilities[${container.children.length}].availableSeats" class="form-control" placeholder="Nhập số ghế trống" required />
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger" onclick="removeAvailability(this)">Xóa</button>
                </div>
            </div>
        `;
        container.appendChild(newItem);
    }

    function removeAvailability(button) {
        button.closest(".availability-item").remove();
    }
</script>
